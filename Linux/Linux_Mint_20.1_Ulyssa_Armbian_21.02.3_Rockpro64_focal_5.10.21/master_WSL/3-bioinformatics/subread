#!/bin/bash
#Este script Ã© executado atraves de um script primario
w=$(tput sgr0) 
r=$(tput setaf 1)
g=$(tput setaf 2) 
y=$(tput setaf 3) 
USAGE="USAGE: $0 -u <username>"
if [ "$#" -lt "1" ] 
then 
    echo -e $USAGE;
exit 1    
else 
    var1=$2;
fi

while getopts u: option
do
case "${option}"
in
u) user_name=$OPTARG;;
esac
done

if [ "$user_name" = "" ]; then
"${g}Error, missing arguments:${y} -u | User name | <string>
${w}$USAGE"
exit 1
fi
threads=`nproc`

#SUBREAD
subread_tar=/home/$user_name/subread-2.0.3-source.tar.gz
subread_path=/home/$user_name/subread-2.0.3-source
subread_url=https://megalink.dl.sourceforge.net/project/subread/subread-2.0.3/subread-2.0.3-source.tar.gz
su -c "cd ~/ && wget $subread_url" $user_name
su -c "cd ~/ && tar zxf $subread_tar" $user_name
su -c "cd $subread_path/src && make -f Makefile.Linux" $user_name
cp -R $subread_path -t /usr/local/bin/
ln -fs /usr/local/bin/subread-2.0.3-source/bin/exactSNP /usr/local/bin/exactSNP
ln -fs /usr/local/bin/subread-2.0.3-source/bin/featureCounts /usr/local/bin/featureCounts
ln -fs /usr/local/bin/subread-2.0.3-source/bin/subindel /usr/local/bin/subindel
ln -fs /usr/local/bin/subread-2.0.3-source/bin/subjunc /usr/local/bin/subjunc
ln -fs /usr/local/bin/subread-2.0.3-source/bin/sublong /usr/local/bin/sublong
ln -fs /usr/local/bin/subread-2.0.3-source/bin/subread-align /usr/local/bin/subread-align
ln -fs /usr/local/bin/subread-2.0.3-source/bin/subread-buildindex /usr/local/bin/subread-buildindex
rm -rf $subread_tar $subread_path

echo "${g}"
echo    "----------------------------"
echo	"Currently installed version:"
echo    "----------------------------${w}"
subread-align -v
echo    "${g}----------------------------"
